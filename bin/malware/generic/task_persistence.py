"""This scripts attempts to mimic a piece of malware that is trying to maintain
persistance.

1. Scheduled task that launches at run time.


This will always use the same exact task and registry key name. I use the same names
as malware uses in the wild:

Task name source:
    * https://www.reverse.it/sample/aa8f077a5feeb9fa9dcffd3c69724c942d5ce173519c1c9df838804c9444bd30?environmentId=100
    ``` 
    schtasks.exe schtasks /create /SC MINUTE /MO 15 /tn 69430l1fh687n1r4i59 /TR %TEMP%\_HOW_TO_DECRYPT_MY_FILES_69430l1fh687n1r4i59_.txt (PID: 3564)
    ```

"""

from ..malware import Malware

TASK_NAME = "69430l1fh687n1r4i59"

# The executable name attempts to impersonate the real svchost.exe process
PATH = "C:/windows/system32/" 
NAME = "svch0st.exe"


class TaskPersist(Malware):
    
    def __init__(self):
        super(TaskPersist, self).__init__(NAME, PATH)

        self.create_schd_task(
            name=TASK_NAME,
            cmd=PATH + NAME, # Run the process
        )

if __name__ == "__main__":
    TaskPersist()

